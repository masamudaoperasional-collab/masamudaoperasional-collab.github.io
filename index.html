<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Form Rekam Pengeluaran</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    body {font-family: 'Poppins', sans-serif; margin: 30px; background: #f9fafb; color: #333;}
    h2 { text-align: center; margin-bottom: 20px; color: #2563eb; font-weight: 600; }
    form, .card { max-width: 1000px; margin: auto; background: white; padding: 20px 30px;
           border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);}
    .form-row { display: flex; gap: 20px; margin-bottom: 15px; }
    .form-group { flex: 1; }
    label { font-weight: 500; display: block; margin-bottom: 6px; }
    select, input[type="number"], input[type="text"], textarea {
      width: 100%; padding: 6px 10px; border: 1px solid #ccc;
      border-radius: 6px; outline: none; font-family: 'Poppins', sans-serif; box-sizing: border-box;
    }
    textarea { resize: vertical; min-height: 120px; }
    .date-nav { display: flex; align-items: center; gap: 8px; }
    .date-nav button { padding: 6px 12px; background: #2563eb; color: white;
                       border-radius: 6px; border: none; cursor: pointer; font-weight: 500;}
    .date-nav button:hover { background: #1d4ed8; }
    .date-nav input { text-align: center; background: #f9fafb; border: 1px solid #ccc; }
    .table-header { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; margin-bottom: 5px; }
    .table-header h3 { margin: 0; font-weight: 600; color: #111827; }
    table { width: 100%; border-collapse: collapse; margin-top: 5px;
            border-radius: 8px; overflow: hidden; font-size: 14px; }
    th, td { border: 1px solid #e5e7eb; padding: 6px; text-align: center; }
    th { background-color: #f3f4f6; font-weight: 500; }
    tr:hover td { background-color: #f9fafb; }
    button { padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer;
             font-weight: 500; transition: 0.2s; font-family: 'Poppins', sans-serif;}
    .add-btn { background: #2563eb; color: white; margin-top: 12px; }
    .remove-btn { background: #ef4444; color: white; }
    .submit-btn { background: #10b981; color: white; margin-top: 20px; display: block; margin-left: auto; margin-right: auto; }
    .back-btn { background: #ef4444; color: white; margin-right: 10px; }
    .confirm-btn { background: #10b981; color: white; }
    pre { background: #f4f4f4; padding: 10px; margin-top: 20px; font-size: 13px; white-space: pre-wrap; }
    /* Kolom bahan baku */
    #bahanTable th:nth-child(1), #bahanTable td:nth-child(1) { width: 30%; }
    #bahanTable th:nth-child(2), #bahanTable td:nth-child(2) { width: 10%; }
    #bahanTable th:nth-child(3), #bahanTable td:nth-child(3) { width: 10%; }
    #bahanTable th:nth-child(4), #bahanTable td:nth-child(4) { width: 20%; }
    #bahanTable th:nth-child(5), #bahanTable td:nth-child(5) { width: 20%; }
    #bahanTable th:nth-child(6), #bahanTable td:nth-child(6) { width: 10%; }
    #bahanTable td select, #bahanTable td input { width: 100%; box-sizing: border-box; font-size: 13px; }
  </style>
</head>
<body>

  <h2>Form Rekam Pengeluaran</h2>
  
  <!-- Step 1: Form -->
  <form id="pengeluaranForm">
    <div class="form-row">
      <div class="form-group">
        <label for="jenis">Jenis Pengeluaran:</label>
        <select id="jenis" name="jenis">
          <option value="bahan_baku">Bahan Baku</option>
          <option value="operasional">Operasional</option>
          <option value="lainnya">Lainnya</option>
        </select>
      </div>
      <div class="form-group">
        <label for="tanggal">Tanggal:</label>
        <div class="date-nav">
          <button type="button" onclick="ubahTanggal(-1)">⬅</button>
          <input type="text" id="tanggal" name="tanggal" readonly>
          <button type="button" onclick="ubahTanggal(1)">➡</button>
        </div>
      </div>
    </div>

    <div id="tableContainer"></div>

    <div class="form-group" style="margin-top:20px;">
      <label for="keterangan">Keterangan Tambahan:</label>
      <textarea id="keterangan" name="keterangan" placeholder="Tambahkan catatan tambahan di sini..."></textarea>
    </div>

    <button type="submit" class="submit-btn">Lanjut Review</button>
  </form>

  <!-- Step 2: Review -->
  <div id="reviewCard" class="card" style="display:none;">
    <h3>Review Data Anda</h3>
    <table>
      <tbody id="reviewTable"></tbody>
    </table>
    <div style="margin-top:20px; text-align:center;">
      <button class="back-btn" onclick="goBack()">Kembali</button>
      <button class="confirm-btn" onclick="confirmSubmit()">Konfirmasi & Kirim</button>
    </div>
    <pre id="status"></pre>
  </div>

    <!-- Step 3: Halaman Terima Kasih -->
    <div id="thankyouCard" class="card" style="display:none; text-align:center;">
      <h3>Terima kasih!</h3>
      <p>Data pengeluaran Anda berhasil dikirim.</p>
      <button class="submit-btn" onclick="startNew()">Mulai Input Baru</button>
    </div>


  <script>
    let currentDate = new Date();
    tampilkanTanggal();
    function tampilkanTanggal() {
      document.getElementById("tanggal").value = currentDate.toLocaleDateString("id-ID", {
        day: "2-digit", month: "2-digit", year: "numeric"
      });
    }
    function ubahTanggal(step) { currentDate.setDate(currentDate.getDate() + step); tampilkanTanggal(); }

    function renderTable(jenis) {
      const container = document.getElementById("tableContainer");
      if (jenis === "bahan_baku") {
        container.innerHTML = `
          <div class="table-header"><h3>Daftar Bahan Baku</h3></div>
          <table id="bahanTable">
            <thead>
              <tr>
                <th>Nama Barang</th><th>Kuantitas</th><th>Satuan</th>
                <th>Harga (Rp)</th><th>Total Harga (Rp)</th><th>Aksi</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <select name="nama_barang[]">
                    <option value="Air Cleo">Air Cleo</option>
                    <option value="Mineral Botol Cleo">Mineral Botol Cleo</option>
                    <option value="Es Batu IPB">Es Batu IPB</option>
                    <option value="House Blend Beans; Omni Roaster">House Blend Beans; Omni Roaster</option>
                    <option value="FM UHT; Diamond">FM UHT; Diamond</option>
                    <option value="FM COCO; Frisian Flag">FM COCO; Frisian Flag</option>
                    <option value="Aren Cair; Omni Roaster">Aren Cair; Omni Roaster</option>
                    <option value="Chai Syrup; Monin">Chai Syrup; Monin</option>
                    <option value="Pistachio Syrup; W&C">Pistachio Syrup; W&C</option>
                    <option value="Caramel Syrup; Dripp">Caramel Syrup; Dripp</option>
                    <option value="Banana Syrup; W&C">Banana Syrup; W&C</option>
                    <option value="Strawberry Pure; W&C">Strawberry Pure; W&C</option>
                    <option value="Creamer; W&C">Creamer; W&C</option>
                    <option value="SKM Dairy Champ">SKM Dairy Champ</option>
                    <option value="Gula Pasir; PSM">Gula Pasir; PSM</option>
                    <option value="Perisa Pandan; Koepoe">Perisa Pandan; Koepoe</option>
                    <option value="Matcha Powder; Denali">Matcha Powder; Denali</option>
                    <option value="Cinnamon Powder; Koepoe">Cinnamon Powder; Koepoe</option>
                    <option value="Dark Choco Powder; Delmoro">Dark Choco Powder; Delmoro</option>
                    <option value="Avocado Powder">Avocado Powder</option>
                    <option value="Jeruk Peras">Jeruk Peras</option>
                    <option value="Biji Selasih">Biji Selasih</option>
                    <option value="Nata De Coco">Nata De Coco</option>
                    <option value="Earlgrey; Toe a Tea">Earlgrey; Toe a Tea</option>
                    <option value="Black Tea; Goalpara">Black Tea; Goalpara</option>
                    <option value="Single Origin varian1">Single Origin varian1</option>
                    <option value="Single Origin varian2">Single Origin varian2</option>
                    <option value="Simple Syrup">Simple Syrup</option>
                    <option value="Masa Base">Masa Base</option>
                    <option value="Muda Base">Muda Base</option>
                    <option value="Chocolate Base">Chocolate Base</option>
                    <option value="Matcha Base">Matcha Base</option>
                    <option value="Black Tea Base">Black Tea Base</option>
                    <option value="Espresso Base">Espresso Base</option>
                    <option value="Espresso Cinn Base">Espresso Cinn Base</option>
                    <option value="Strawberry Frozen">Strawberry Frozen</option>
                    <option value="Alpukat Frozen">Alpukat Frozen</option>
                    <option value="Pisang Frozen">Pisang Frozen</option>
                    <option value="Ice Cup">Ice Cup</option>
                    <option value="Lid Ice Cup">Lid Ice Cup</option>
                    <option value="Hot Cup">Hot Cup</option>
                    <option value="Lid Hot Cup">Lid Hot Cup</option>
                    <option value="Plastik Mini TA">Plastik Mini TA</option>
                    <option value="Plastik Big TA">Plastik Big TA</option>
                    <option value="Sendok TA">Sendok TA</option>
                    <option value="Mini Thermal">Mini Thermal</option>
                    <option value="Big Thermal">Big Thermal</option>
                    <option value="Straw/Sedotan">Straw/Sedotan</option>
                    <option value="Cable Ties">Cable Ties</option>
                    <option value="Floor Cleaner">Floor Cleaner</option>
                    <option value="Table Cleaner">Table Cleaner</option>
                    <option value="Hand Soap">Hand Soap</option>
                    <option value="Sunlight">Sunlight</option>
                    <option value="SiBiru">SiBiru</option>
                    <option value="Porstex">Porstex</option>
                    <option value="Harpic Closet">Harpic Closet</option>
                    <option value="Kamper">Kamper</option>
                    <option value="Trashbag">Trashbag</option>
                    <option value="Kain Pel">Kain Pel</option>
                    <option value="Livi Napkin">Livi Napkin</option>
                    <option value="Livi Multifold">Livi Multifold</option>
                    <option value="Livi Roll WC.">Livi Roll WC.</option>
                    <option value="B Bombai">B Bombai</option>
                    <option value="B Merah">B Merah</option>
                    <option value="B Putih">B Putih</option>
                    <option value="C Merah Besar">C Merah Besar</option>
                    <option value="C Merah Keriting">C Merah Keriting</option>
                    <option value="Tomat">Tomat</option>
                    <option value="Timun">Timun</option>
                    <option value="Wortel">Wortel</option>
                    <option value="D Bawang">D Bawang</option>
                    <option value="D Jeruk">D Jeruk</option>
                    <option value="D Salam">D Salam</option>
                    <option value="D Parsley">D Parsley</option>
                    <option value="Jahe">Jahe</option>
                    <option value="Kelapa Parut">Kelapa Parut</option>
                    <option value="Kemangi">Kemangi</option>
                    <option value="Kemiri">Kemiri</option>
                    <option value="Kol">Kol</option>
                    <option value="Kunyit">Kunyit</option>
                    <option value="Lengkuas Parut">Lengkuas Parut</option>
                    <option value="Uli">Uli</option>
                    <option value="Selada">Selada</option>
                    <option value="Pakcoy">Pakcoy</option>
                    <option value="Kacang Panjang">Kacang Panjang</option>
                    <option value="Brokoli">Brokoli</option>
                    <option value="Sereh">Sereh</option>
                    <option value="Mix Vegetabls">Mix Vegetabls</option>
                    <option value="Coklat Clara">Coklat Clara</option>
                    <option value="Beras Pera">Beras Pera</option>
                    <option value="Beras Normal">Beras Normal</option>
                    <option value="Ayam Serundeng">Ayam Serundeng</option>
                    <option value="Ayam Fillet Crispy">Ayam Fillet Crispy</option>
                    <option value="Ayam Saus Mentega">Ayam Saus Mentega</option>
                    <option value="Ayam Nasi Goreng Kemangi">Ayam Nasi Goreng Kemangi</option>
                    <option value="Telur">Telur</option>
                    <option value="Saus Tomat; Delmonte">Saus Tomat; Delmonte</option>
                    <option value="Saus Cabai; Delmonte">Saus Cabai; Delmonte</option>
                    <option value="Saus Tiram; Cap Panda">Saus Tiram; Cap Panda</option>
                    <option value="Mayonaise">Mayonaise</option>
                    <option value="Kecap Maggi">Kecap Maggi</option>
                    <option value="Cuka Makan">Cuka Makan</option>
                    <option value="Minyak">Minyak</option>
                    <option value="Soda Kue">Soda Kue</option>
                    <option value="Chicken Powder">Chicken Powder</option>
                    <option value="Marinasi Bubuk">Marinasi Bubuk</option>
                    <option value="Ketumbar Bubuk">Ketumbar Bubuk</option>
                    <option value="Tepung Maizena">Tepung Maizena</option>
                    <option value="B Putih Bubuk">B Putih Bubuk</option>
                    <option value="Merica Bubuk">Merica Bubuk</option>
                    <option value="Tepung Terigu">Tepung Terigu</option>
                    <option value="Tepung Kentucky">Tepung Kentucky</option>
                    <option value="Tepung Roti">Tepung Roti</option>
                    <option value="Kertas Minyak">Kertas Minyak</option>
                    <option value="Plastik bwng 1/4">Plastik bwng 1/4</option>
                    <option value="Plastik bwng 2kg">Plastik bwng 2kg</option>
                    <option value="Sendok TA">Sendok TA</option>
                    <option value="Bento TA">Bento TA</option>
                    <option value="Bowl TA">Bowl TA</option>
                    <option value="Tisu Roll Kitchen">Tisu Roll Kitchen</option>
                    <option value="Trashbag">Trashbag</option>
                    <option value="HandGlove">HandGlove</option>
                    <option value="Cup Saus">Cup Saus</option>
                    <option value="Sunlight">Sunlight</option>
                  </select>
                </td>
                <td><input type="number" name="kuantitas[]" min="1" value="1" oninput="hitungTotal(this)"></td>
                <td>
                  <select name="satuan[]"><option value="kg">Kg</option><option value="liter">Liter</option><option value="pcs">Pcs</option><option value="gal">Galon</option><option value="bal">Bal</option><option value="pack">Pack</option><option value="jerigen">Jerigen</option><option value="karton">Karton</option></select>
                </td>
                <td><input type="number" name="harga[]" min="0" step="100" placeholder="Rp" oninput="hitungTotal(this)"></td>
                <td><input type="text" name="total[]" readonly></td>
                <td><button type="button" class="remove-btn" onclick="hapusRow(this)">Hapus</button></td>
              </tr>
            </tbody>
          </table>
          <button type="button" class="add-btn" onclick="tambahRow()">+ Tambah Barang</button>
        `;
      } else if (jenis === "operasional") {
        container.innerHTML = `
          <div class="table-header"><h3>Biaya Operasional</h3></div>
          <table id="operasionalTable">
            <thead>
              <tr><th>Jenis Operasional</th><th>Biaya (Rp)</th><th>Bulan</th><th>PIC</th><th>Aksi</th></tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <select name="jenis_operasional[]">
                    <option value="listrik">Listrik</option><option value="air">Air</option>
                    <option value="internet">Internet</option><option value="sewa">Sewa</option>
                  </select>
                </td>
                <td><input type="number" name="biaya[]" min="0" step="100" placeholder="Rp"></td>
                <td>
                  <select name="bulan[]">
                    <option>Januari</option><option>Februari</option><option>Maret</option><option>April</option>
                    <option>Mei</option><option>Juni</option><option>Juli</option><option>Agustus</option>
                    <option>September</option><option>Oktober</option><option>November</option><option>Desember</option>
                  </select>
                </td>
                <td>
                  <select name="pic[]"><option value="person1">Person1</option><option value="person2">Person2</option><option value="person3">Person3</option></select>
                </td>
                <td><button type="button" class="remove-btn" onclick="hapusRow(this)">Hapus</button></td>
              </tr>
            </tbody>
          </table>
          <button type="button" class="add-btn" onclick="tambahRow()">+ Tambah Baris</button>
        `;
      } else {
        container.innerHTML = `<p style="text-align:center; color:#666;">Silakan pilih jenis pengeluaran</p>`;
      }
    }

    function tambahRow() {
      const table = document.querySelector("#tableContainer table tbody");
      if (!table) return;
      const newRow = table.rows[0].cloneNode(true);
      newRow.querySelectorAll("input").forEach(input => input.value = "");
      table.appendChild(newRow);
    }
    function hapusRow(btn) {
      const row = btn.closest("tr"); const table = row.parentNode;
      if (table.rows.length > 1) row.remove();
      else alert("Minimal 1 baris harus ada.");
    }
    function hitungTotal(elem) {
      const row = elem.closest("tr");
      const qty = row.querySelector("input[name='kuantitas[]']").value || 0;
      const harga = row.querySelector("input[name='harga[]']").value || 0;
      row.querySelector("input[name='total[]']").value = (qty * harga).toLocaleString("id-ID");
    }

    document.getElementById("jenis").addEventListener("change", function() { renderTable(this.value); });
    renderTable(document.getElementById("jenis").value);

    let formDataCache = null;

    document.getElementById("pengeluaranForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const jenis = document.getElementById("jenis").value;
      const tanggal = document.getElementById("tanggal").value;
      const keterangan = document.getElementById("keterangan").value;

      let items = [];
      if (jenis === "bahan_baku") {
        items = Array.from(document.querySelectorAll("#bahanTable tbody tr")).map(row => ({
          nama_barang: row.querySelector("select[name='nama_barang[]']").value,
          kuantitas: row.querySelector("input[name='kuantitas[]']").value,
          satuan: row.querySelector("select[name='satuan[]']").value,
          harga: row.querySelector("input[name='harga[]']").value,
          total: row.querySelector("input[name='total[]']").value
        }));
      } else if (jenis === "operasional") {
        items = Array.from(document.querySelectorAll("#operasionalTable tbody tr")).map(row => ({
          jenis_operasional: row.querySelector("select[name='jenis_operasional[]']").value,
          biaya: row.querySelector("input[name='biaya[]']").value,
          bulan: row.querySelector("select[name='bulan[]']").value,
          pic: row.querySelector("select[name='pic[]']").value
        }));
      }

      formDataCache = { jenis, tanggal, keterangan, items };

      // Render review table
      const reviewTable = document.getElementById("reviewTable");
      let rows = `
        <tr><th>Jenis Pengeluaran</th><td>${jenis}</td></tr>
        <tr><th>Tanggal</th><td>${tanggal}</td></tr>
        <tr><th>Keterangan</th><td>${keterangan || "-"}</td></tr>
      `;

      if (items.length > 0) {
        rows += `<tr><th colspan="2">Detail</th></tr>`;
        rows += `<tr><td colspan="2">
          <table style="width:100%; border-collapse: collapse; font-size:13px;">
            <thead>`;
        if (jenis === "bahan_baku") {
          rows += `<tr>
              <th>Nama Barang</th><th>Kuantitas</th><th>Satuan</th>
              <th>Harga</th><th>Total</th>
            </tr></thead><tbody>`;
          items.forEach(it => {
            rows += `<tr>
              <td>${it.nama_barang}</td><td>${it.kuantitas}</td><td>${it.satuan}</td>
              <td>${it.harga}</td><td>${it.total}</td>
            </tr>`;
          });
        } else if (jenis === "operasional") {
          rows += `<tr>
              <th>Jenis</th><th>Biaya</th><th>Bulan</th><th>PIC</th>
            </tr></thead><tbody>`;
          items.forEach(it => {
            rows += `<tr>
              <td>${it.jenis_operasional}</td><td>${it.biaya}</td>
              <td>${it.bulan}</td><td>${it.pic}</td>
            </tr>`;
          });
        }
        rows += `</tbody></table></td></tr>`;
      }

      reviewTable.innerHTML = rows;

      document.getElementById("pengeluaranForm").style.display = "none";
      document.getElementById("reviewCard").style.display = "block";
    });

    function goBack() {
      document.getElementById("reviewCard").style.display = "none";
      document.getElementById("pengeluaranForm").style.display = "block";
    }

    async function confirmSubmit() {
      if (!formDataCache) return;
      try {
        const res = await fetch("https://n8n-uievozfh3got.bgxy.sumopod.my.id/webhook-test/097b51de-67e9-4abe-9e0c-d1018c286912", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(formDataCache, null, 2)
        });
        const result = await res.text();
    
        // Kalau berhasil, tampilkan halaman terima kasih
        document.getElementById("reviewCard").style.display = "none";
        document.getElementById("thankyouCard").style.display = "block";
      } catch (err) {
        document.getElementById("status").textContent = "Error: " + err;
      }
    }
    
    function startNew() {
      // arahkan ke URL form awal
      window.location.href = "https://masamudaoperasional-collab.github.io/"; 
    }

  </script>

</body>
</html>
