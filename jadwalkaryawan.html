<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Jadwal Karyawan - masa.muda</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: #f8f9fa;
      color: #333;
      line-height: 1.5;
      padding: 15px;
      font-size: 14px;
    }
    
    .container {
      max-width: 100%;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 20px;
      padding: 15px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .logo {
      font-family: 'Poppins', sans-serif;
      font-size: 28px;
      color: #7c895d;
      margin-bottom: 5px;
      font-weight: 500;
      letter-spacing: 1px;
    }
    
    .subtitle {
      color: #6c757d;
      font-size: 14px;
      font-weight: 400;
    }
    
    .admin-controls {
      margin-bottom: 15px;
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .admin-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .edit-btn, .save-btn, .load-btn, .date-btn, .guide-btn {
      background: #7c895d;
      color: white;
      border: none;
      padding: 12px 10px;
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      transition: .3s;
      font-family: 'Poppins', sans-serif;
    }
    
    .edit-btn:hover, .save-btn:hover, .load-btn:hover, .date-btn:hover, .guide-btn:hover {
      background: #6a7850;
    }
    
    .edit-btn.exit {
      background: #dc3545;
    }
    
    .edit-btn.exit:hover {
      background: #c82333;
    }
    
    .save-btn {
      background: #28a745;
    }
    
    .save-btn:hover {
      background: #218838;
    }
    
    .load-btn {
      background: #17a2b8;
    }
    
    .load-btn:hover {
      background: #138496;
    }
    
    .date-btn {
      background: #6f42c1;
    }
    
    .date-btn:hover {
      background: #5a2d91;
    }
    
    .guide-btn {
      background: #fd7e14;
      grid-column: 1 / -1;
    }
    
    .guide-btn:hover {
      background: #e66a00;
    }
    
    .week-navigation {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f8f9fa;
      padding: 10px;
      border-radius: 8px;
    }
    
    .week-nav-btn {
      background: #6c757d;
      color: white;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }
    
    .week-nav-btn:hover {
      background: #5a6268;
    }
    
    #currentWeekDisplay {
      font-weight: 500;
      text-align: center;
      font-size: 14px;
    }
    
    .password-modal, .date-modal, .guide-modal, .legend-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 15px;
    }
    
    .password-modal-content, .date-modal-content, .guide-modal-content, .legend-modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-title {
      margin-bottom: 15px;
      text-align: center;
      font-size: 18px;
      color: #7c895d;
    }
    
    .password-input, .date-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-bottom: 15px;
      font-family: 'Poppins', sans-serif;
      font-size: 14px;
    }
    
    .date-input-group {
      margin-bottom: 15px;
    }
    
    .date-input-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      font-size: 14px;
    }
    
    .modal-buttons {
      display: flex;
      gap: 10px;
    }
    
    .modal-buttons button {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      font-size: 14px;
    }
    
    .btn-cancel {
      background: #f5f5f5;
      color: #666;
    }
    
    .btn-confirm {
      background: #7c895d;
      color: white;
    }
    
    .schedule-section {
      margin-bottom: 25px;
    }
    
    .section-title {
      font-size: 16px;
      color: #7c895d;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 2px solid #7c895d;
    }
    
    .schedule-table-container {
      overflow-x: auto;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      background: #fff;
    }
    
    .schedule-table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      min-width: 600px;
    }
    
    .schedule-table th,
    .schedule-table td {
      padding: 10px 6px;
      text-align: center;
      border: 1px solid #e0e0e0;
      font-size: 12px;
    }
    
    .schedule-table th {
      background: #f8f9fa;
      font-weight: 500;
    }
    
    .schedule-table thead th {
      background: #7c895d;
      color: white;
      font-weight: 500;
      font-size: 12px;
    }
    
    .employee-name {
      font-weight: 500;
      font-size: 13px;
    }
    
    .shift-cell {
      position: relative;
    }
    
    .shift-display {
      display: inline-block;
      width: 26px;
      height: 26px;
      line-height: 26px;
      border-radius: 50%;
      font-weight: 500;
      text-align: center;
      font-size: 11px;
    }
    
    .shift-select {
      width: 100%;
      padding: 4px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background: white;
      font-family: 'Poppins', sans-serif;
      text-align: center;
      font-size: 11px;
    }
    
    .employee-select {
      width: 100%;
      padding: 6px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background: white;
      font-family: 'Poppins', sans-serif;
      font-size: 12px;
    }
    
    /* Warna untuk status shift */
    .shift-P { background-color: #90EE90; color: #2e7d32; } /* Pagi - Hijau muda */
    .shift-C { background-color: #32CD32; color: white; }   /* Closing - Hijau */
    .shift-L { background-color: #FF0000; color: white; }   /* Libur - Merah dengan teks putih */
    .shift-S { background-color: #FFB6C1; color: #c62828; } /* Sakit - Merah muda */
    .shift-U { background-color: #FFA500; color: white; }   /* Cuti - Oranye */
    .shift-I { background-color: #87CEEB; color: #1565c0; } /* Izin - Biru muda */
    
    .message {
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      text-align: center;
      display: none;
      font-size: 13px;
    }
    
    .message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }
    
    .message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }
    
    .message.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
      display: block;
    }
    
    .legend-card {
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      margin-bottom: 20px;
    }
    
    .legend-title {
      font-size: 16px;
      color: #7c895d;
      margin-bottom: 12px;
      text-align: center;
    }
    
    .legend-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
    }
    
    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 500;
      font-size: 10px;
    }
    
    .guide-content {
      font-size: 13px;
      line-height: 1.6;
    }
    
    .guide-section {
      margin-bottom: 15px;
    }
    
    .guide-section h4 {
      color: #7c895d;
      margin-bottom: 8px;
      font-size: 14px;
    }
    
    .guide-section ul {
      padding-left: 20px;
    }
    
    .guide-section li {
      margin-bottom: 5px;
    }
    
    .footer {
      text-align: center;
      margin-top: 30px;
      color: #6c757d;
      font-size: 12px;
      padding: 15px;
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      z-index: 1001;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      max-width: 300px;
      display: none;
    }
    
    .notification.success {
      background: #28a745;
    }
    
    .notification.error {
      background: #dc3545;
    }
    
    .notification.info {
      background: #17a2b8;
    }
    
    @media (max-width: 480px) {
      body {
        padding: 10px;
        font-size: 13px;
      }
      
      .admin-buttons {
        grid-template-columns: 1fr;
      }
      
      .schedule-table th,
      .schedule-table td {
        padding: 8px 4px;
        font-size: 11px;
      }
      
      .shift-display {
        width: 22px;
        height: 22px;
        line-height: 22px;
        font-size: 10px;
      }
      
      .legend-grid {
        grid-template-columns: 1fr;
      }
    }
    
    @media (min-width: 768px) {
      .container {
        max-width: 750px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">masa.muda</div>
      <div class="subtitle">Manajemen Penjadwalan Karyawan</div>
    </div>
    
    <div class="legend-card">
      <div class="legend-title">Keterangan Shift</div>
      <div class="legend-grid">
        <div class="legend-item">
          <div class="legend-color shift-P">P</div>
          <span>Shift Pagi</span>
        </div>
        <div class="legend-item">
          <div class="legend-color shift-C">C</div>
          <span>Shift Closing</span>
        </div>
        <div class="legend-item">
          <div class="legend-color shift-L">L</div>
          <span>Libur</span>
        </div>
        <div class="legend-item">
          <div class="legend-color shift-S">S</div>
          <span>Sakit</span>
        </div>
        <div class="legend-item">
          <div class="legend-color shift-U">U</div>
          <span>Cuti</span>
        </div>
        <div class="legend-item">
          <div class="legend-color shift-I">I</div>
          <span>Izin</span>
        </div>
      </div>
    </div>
    
    <div class="admin-controls">
      <div class="admin-buttons">
        <button class="edit-btn" id="editScheduleBtn">Edit Jadwal</button>
        <button class="save-btn" id="saveScheduleBtn" style="display: none;">Simpan</button>
        <button class="load-btn" id="loadScheduleBtn">Muat Data</button>
        <button class="date-btn" id="editDateBtn" style="display: none;">Ubah Tanggal</button>
        <button class="guide-btn" id="guideBtn">Panduan & SOP</button>
      </div>
      <div class="week-navigation">
        <button class="week-nav-btn" id="prevWeekBtn">‚Äπ</button>
        <div id="currentWeekDisplay"></div>
        <button class="week-nav-btn" id="nextWeekBtn">‚Ä∫</button>
      </div>
    </div>
    
    <div class="message" id="message"></div>
    
    <!-- Tabel Jadwal Barista -->
    <div class="schedule-section">
      <h2 class="section-title">üìã Jadwal Barista</h2>
      <div class="schedule-table-container">
        <table class="schedule-table" id="baristaSchedule">
          <thead>
            <tr>
              <th>Nama Karyawan</th>
              <!-- Kolom tanggal akan diisi oleh JavaScript -->
            </tr>
          </thead>
          <tbody>
            <!-- Baris karyawan akan diisi oleh JavaScript -->
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Tabel Jadwal Kitchen -->
    <div class="schedule-section">
      <h2 class="section-title">üç≥ Jadwal Kitchen</h2>
      <div class="schedule-table-container">
        <table class="schedule-table" id="kitchenSchedule">
          <thead>
            <tr>
              <th>Nama Karyawan</th>
              <!-- Kolom tanggal akan diisi oleh JavaScript -->
            </tr>
          </thead>
          <tbody>
            <!-- Baris karyawan akan diisi oleh JavaScript -->
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="footer">
      &copy; 2024 masa.muda - All rights reserved
    </div>
  </div>

  <!-- Modal untuk password admin -->
  <div class="password-modal" id="passwordModal">
    <div class="password-modal-content">
      <h3 class="modal-title">Masukkan Password Admin</h3>
      <input type="password" class="password-input" id="adminPassword" placeholder="Password admin">
      <div class="modal-buttons">
        <button class="btn-cancel" id="cancelPassword">Batal</button>
        <button class="btn-confirm" id="confirmPassword">Masuk</button>
      </div>
    </div>
  </div>
  
  <!-- Modal untuk edit tanggal -->
  <div class="date-modal" id="dateModal">
    <div class="date-modal-content">
      <h3 class="modal-title">Ubah Periode Jadwal</h3>
      <div class="date-input-group">
        <label for="startDate">Tanggal Mulai (Hari Pertama):</label>
        <input type="date" class="date-input" id="startDate">
      </div>
      <div class="date-input-group">
        <label>Periode yang akan ditampilkan:</label>
        <div id="datePreview" style="font-weight: 500; text-align: center; padding: 8px; background: #f8f9fa; border-radius: 5px;"></div>
      </div>
      <div class="modal-buttons">
        <button class="btn-cancel" id="cancelDate">Batal</button>
        <button class="btn-confirm" id="confirmDate">Terapkan</button>
      </div>
    </div>
  </div>
  
  <!-- Modal untuk panduan dan SOP -->
  <div class="guide-modal" id="guideModal">
    <div class="guide-modal-content">
      <h3 class="modal-title">Panduan & SOP Perubahan Jadwal</h3>
      <div class="guide-content">
        <div class="guide-section">
          <h4>üìù Cara Mengedit Jadwal:</h4>
          <ul>
            <li>Klik tombol "Edit Jadwal" dan masukkan password admin</li>
            <li>Pilih karyawan dari dropdown di kolom nama</li>
            <li>Atur shift untuk setiap hari dengan dropdown di setiap sel</li>
            <li>Gunakan tombol "Ubah Tanggal" untuk mengubah periode jadwal</li>
            <li>Klik "Simpan" untuk menyimpan perubahan ke server</li>
          </ul>
        </div>
        
        <div class="guide-section">
          <h4>‚öôÔ∏è SOP Perubahan Jadwal:</h4>
          <ul>
            <li><strong>Karyawan Sakit:</strong>
              <ul>
                <li>Koordinasi dengan admin untuk perubahan jadwal</li>
                <li>Admin mencari backup pengganti yang dapat dihubungi</li>
                <li>Wajib menyertakan surat keterangan dokter sebagai bukti</li>
              </ul>
            </li>
            <li><strong>Perubahan Lainnya:</strong>
              <ul>
                <li>Semua perubahan jadwal harus didiskusikan dengan penanggung jawab penjadwalan</li>
                <li>Perubahan harus disetujui sebelum diterapkan</li>
                <li>Catatan perubahan harus disimpan untuk dokumentasi</li>
              </ul>
            </li>
          </ul>
        </div>
        
        <div class="guide-section">
          <h4>üîê Hak Akses:</h4>
          <ul>
            <li>Hanya admin yang dapat mengedit jadwal</li>
            <li>Karyawan hanya dapat melihat jadwal yang sudah ditetapkan</li>
            <li>Password admin hanya diberikan kepada penanggung jawab penjadwalan</li>
          </ul>
        </div>
      </div>
      <div class="modal-buttons">
        <button class="btn-confirm" id="closeGuide">Tutup</button>
      </div>
    </div>
  </div>

  <!-- Notifikasi Popup -->
  <div class="notification" id="notification"></div>

  <script>
    // Konfigurasi
    const ADMIN_PASSWORD = "admin123";
    const DAYS_OF_WEEK = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
    const WEBHOOK_GET_URL = "https://n8n-uievozfh3got.bgxy.sumopod.my.id/webhook-test/ambil-shift";
    const WEBHOOK_POST_URL = "https://n8n-uievozfh3got.bgxy.sumopod.my.id/webhook-test/simpan-shift";
    const EMPLOYEE_WEBHOOK_URL = "https://n8n-uievozfh3got.bgxy.sumopod.my.id/webhook-test/employeeId";
    
    // Opsi shift
    const SHIFT_OPTIONS = [
      { code: 'P', name: 'Pagi' },
      { code: 'C', name: 'Closing' },
      { code: 'L', name: 'Libur' },
      { code: 'S', name: 'Sakit' },
      { code: 'U', name: 'Cuti' },
      { code: 'I', name: 'Izin' }
    ];
    
    // DOM Elements
    const editScheduleBtn = document.getElementById('editScheduleBtn');
    const saveScheduleBtn = document.getElementById('saveScheduleBtn');
    const loadScheduleBtn = document.getElementById('loadScheduleBtn');
    const editDateBtn = document.getElementById('editDateBtn');
    const guideBtn = document.getElementById('guideBtn');
    const prevWeekBtn = document.getElementById('prevWeekBtn');
    const nextWeekBtn = document.getElementById('nextWeekBtn');
    const passwordModal = document.getElementById('passwordModal');
    const dateModal = document.getElementById('dateModal');
    const guideModal = document.getElementById('guideModal');
    const adminPasswordInput = document.getElementById('adminPassword');
    const startDateInput = document.getElementById('startDate');
    const datePreview = document.getElementById('datePreview');
    const cancelPasswordBtn = document.getElementById('cancelPassword');
    const confirmPasswordBtn = document.getElementById('confirmPassword');
    const cancelDateBtn = document.getElementById('cancelDate');
    const confirmDateBtn = document.getElementById('confirmDate');
    const closeGuideBtn = document.getElementById('closeGuide');
    const currentWeekDisplay = document.getElementById('currentWeekDisplay');
    const baristaSchedule = document.getElementById('baristaSchedule');
    const kitchenSchedule = document.getElementById('kitchenSchedule');
    const messageEl = document.getElementById('message');
    const notificationEl = document.getElementById('notification');
    
    // State aplikasi
    let isEditMode = false;
    let currentWeek = getCurrentWeek();
    let employeesData = [];
    
    // Inisialisasi aplikasi
    async function init() {
      // Coba muat data tanggal dari localStorage
      const savedDate = localStorage.getItem('schedule_start_date');
      if (savedDate) {
        currentWeek = getWeekFromDate(new Date(savedDate));
      }
      
      // Tampilkan minggu saat ini
      displayCurrentWeek();
      
      // Muat data karyawan dari webhook
      await loadEmployeesFromWebhook();
      
      // Coba muat data jadwal dari server
      await loadScheduleFromServer();
      
      // Setup event listeners
      setupEventListeners();
    }
    
    // Muat data karyawan dari webhook
    async function loadEmployeesFromWebhook() {
      showMessage("Memuat data karyawan dari server...", "info");
      
      try {
        const response = await fetch(EMPLOYEE_WEBHOOK_URL);
        
        if (response.ok) {
          const employees = await response.json();
          
          // Proses data karyawan
          processEmployeeData(employees);
          showNotification("‚úÖ Data karyawan berhasil dimuat!", "success");
        } else {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
      } catch (error) {
        console.error('Error loading employees:', error);
        showNotification("‚ùå Gagal memuat data karyawan", "error");
        
        // Fallback ke data karyawan default
        useDefaultEmployees();
        showMessage("‚ÑπÔ∏è Menggunakan data karyawan default", "info");
      }
    }
    
    // Proses data karyawan dari webhook
    function processEmployeeData(employees) {
      // Reset data karyawan
      employeesData = [];
      
      // Konversi data dari webhook ke format yang diinginkan
      employees.forEach(employee => {
        employeesData.push({
          id: employee.employeeId,
          name: employee.Name
        });
      });
      
      // Jika tidak ada data karyawan, gunakan default
      if (employeesData.length === 0) {
        useDefaultEmployees();
      }
    }
    
    // Gunakan data karyawan default jika webhook gagal
    function useDefaultEmployees() {
      employeesData = [
        { id: 'EMP001', name: 'Atiyah' },
        { id: 'EMP002', name: 'Rafli' },
        { id: 'EMP003', name: 'Nayla' },
        { id: 'EMP004', name: 'Lutfi' },
        { id: 'EMP005', name: 'Andriyan' },
        { id: 'EMP006', name: 'Idas' },
        { id: 'EMP007', name: 'DW Backup' }
      ];
    }
    
    // Setup event listeners
    function setupEventListeners() {
      editScheduleBtn.addEventListener('click', toggleEditMode);
      saveScheduleBtn.addEventListener('click', saveScheduleToServer);
      loadScheduleBtn.addEventListener('click', loadScheduleFromServer);
      editDateBtn.addEventListener('click', openDateModal);
      guideBtn.addEventListener('click', openGuideModal);
      prevWeekBtn.addEventListener('click', goToPrevWeek);
      nextWeekBtn.addEventListener('click', goToNextWeek);
      cancelPasswordBtn.addEventListener('click', closePasswordModal);
      confirmPasswordBtn.addEventListener('click', verifyAdminPassword);
      cancelDateBtn.addEventListener('click', closeDateModal);
      confirmDateBtn.addEventListener('click', applyDateChange);
      closeGuideBtn.addEventListener('click', closeGuideModal);
      startDateInput.addEventListener('change', updateDatePreview);
      
      // Enter key untuk password
      adminPasswordInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          verifyAdminPassword();
        }
      });
    }
    
    // Toggle mode edit
    function toggleEditMode() {
      if (isEditMode) {
        // Keluar dari mode edit
        isEditMode = false;
        editScheduleBtn.textContent = 'Edit Jadwal';
        editScheduleBtn.classList.remove('exit');
        saveScheduleBtn.style.display = 'none';
        editDateBtn.style.display = 'none';
        renderScheduleTables();
      } else {
        // Masuk ke mode edit - tampilkan modal password
        openPasswordModal();
      }
    }
    
    // Buka modal password
    function openPasswordModal() {
      passwordModal.style.display = 'flex';
      adminPasswordInput.value = '';
      adminPasswordInput.focus();
    }
    
    // Tutup modal password
    function closePasswordModal() {
      passwordModal.style.display = 'none';
    }
    
    // Buka modal tanggal
    function openDateModal() {
      // Set nilai default ke tanggal mulai minggu ini
      startDateInput.value = currentWeek[0].fullDate;
      updateDatePreview();
      dateModal.style.display = 'flex';
    }
    
    // Tutup modal tanggal
    function closeDateModal() {
      dateModal.style.display = 'none';
    }
    
    // Buka modal panduan
    function openGuideModal() {
      guideModal.style.display = 'flex';
    }
    
    // Tutup modal panduan
    function closeGuideModal() {
      guideModal.style.display = 'none';
    }
    
    // Perbarui pratinjau tanggal
    function updateDatePreview() {
      const startDate = new Date(startDateInput.value);
      if (isNaN(startDate.getTime())) return;
      
      const week = getWeekFromDate(startDate);
      const start = week[0].date;
      const end = week[6].date;
      
      datePreview.textContent = `${start} - ${end}`;
    }
    
    // Terapkan perubahan tanggal
    function applyDateChange() {
      const startDate = new Date(startDateInput.value);
      if (isNaN(startDate.getTime())) {
        showNotification('Tanggal tidak valid!', 'error');
        return;
      }
      
      currentWeek = getWeekFromDate(startDate);
      
      // Simpan tanggal ke localStorage
      localStorage.setItem('schedule_start_date', startDate.toISOString());
      
      displayCurrentWeek();
      renderScheduleTables();
      closeDateModal();
      
      showNotification(`Periode jadwal diubah menjadi ${currentWeek[0].date} - ${currentWeek[6].date}`, "success");
    }
    
    // Pergi ke minggu sebelumnya
    function goToPrevWeek() {
      const firstDay = new Date(currentWeek[0].fullDate);
      firstDay.setDate(firstDay.getDate() - 7);
      currentWeek = getWeekFromDate(firstDay);
      
      // Simpan tanggal ke localStorage
      localStorage.setItem('schedule_start_date', firstDay.toISOString());
      
      displayCurrentWeek();
      renderScheduleTables();
    }
    
    // Pergi ke minggu berikutnya
    function goToNextWeek() {
      const firstDay = new Date(currentWeek[0].fullDate);
      firstDay.setDate(firstDay.getDate() + 7);
      currentWeek = getWeekFromDate(firstDay);
      
      // Simpan tanggal ke localStorage
      localStorage.setItem('schedule_start_date', firstDay.toISOString());
      
      displayCurrentWeek();
      renderScheduleTables();
    }
    
    // Verifikasi password admin
    function verifyAdminPassword() {
      const password = adminPasswordInput.value;
      
      if (password === ADMIN_PASSWORD) {
        isEditMode = true;
        editScheduleBtn.textContent = 'Keluar Edit Mode';
        editScheduleBtn.classList.add('exit');
        saveScheduleBtn.style.display = 'inline-block';
        editDateBtn.style.display = 'inline-block';
        closePasswordModal();
        renderScheduleTables();
        showNotification('Mode edit diaktifkan', 'success');
      } else {
        showNotification('Password salah!', 'error');
        adminPasswordInput.value = '';
        adminPasswordInput.focus();
      }
    }
    
    // Dapatkan minggu dari tanggal tertentu
    function getWeekFromDate(startDate) {
      const week = [];
      const date = new Date(startDate);
      
      for (let i = 0; i < 7; i++) {
        const currentDate = new Date(date);
        currentDate.setDate(date.getDate() + i);
        
        week.push({
          date: currentDate.toLocaleDateString('id-ID', { day: '2-digit', month: '2-digit' }),
          day: DAYS_OF_WEEK[currentDate.getDay()],
          fullDate: currentDate.toISOString().split('T')[0]
        });
      }
      
      return week;
    }
    
    // Dapatkan minggu saat ini
    function getCurrentWeek() {
      return getWeekFromDate(new Date());
    }
    
    // Tampilkan minggu saat ini
    function displayCurrentWeek() {
      const startDate = currentWeek[0].date;
      const endDate = currentWeek[6].date;
      currentWeekDisplay.textContent = `${startDate} - ${endDate}`;
    }
    
    // Inisialisasi data jadwal
    function initializeScheduleData() {
      const scheduleData = {
        barista: [],
        kitchen: [],
        lastUpdated: new Date().toISOString()
      };
      
      // Inisialisasi data untuk barista (4 baris)
      for (let i = 0; i < 4; i++) {
        const employee = employeesData[i] || { id: `temp-${i}`, name: 'Pilih Karyawan' };
        scheduleData.barista.push({
          employeeId: employee.id,
          employeeName: employee.name,
          shifts: Array(7).fill('L')
        });
      }
      
      // Inisialisasi data untuk kitchen (3 baris)
      for (let i = 4; i < 7; i++) {
        const employee = employeesData[i] || { id: `temp-${i}`, name: 'Pilih Karyawan' };
        scheduleData.kitchen.push({
          employeeId: employee.id,
          employeeName: employee.name,
          shifts: Array(7).fill('L')
        });
      }
      
      localStorage.setItem('schedule_data', JSON.stringify(scheduleData));
      return scheduleData;
    }
    
    // Dapatkan data jadwal
    function getScheduleData() {
      const data = localStorage.getItem('schedule_data');
      if (!data) {
        return initializeScheduleData();
      }
      return JSON.parse(data);
    }
    
    // Simpan data jadwal ke localStorage
    function saveScheduleData(data) {
      data.lastUpdated = new Date().toISOString();
      localStorage.setItem('schedule_data', JSON.stringify(data));
    }
    
    // Render tabel jadwal
    function renderScheduleTables() {
      renderScheduleTable('barista', baristaSchedule);
      renderScheduleTable('kitchen', kitchenSchedule);
    }
    
    // Render tabel jadwal untuk bagian tertentu
    function renderScheduleTable(section, tableElement) {
      const scheduleData = getScheduleData();
      const sectionData = scheduleData[section];
      const rowCount = section === 'barista' ? 4 : 3;
      
      // Kosongkan tabel
      tableElement.querySelector('thead tr').innerHTML = '<th>Nama Karyawan</th>';
      tableElement.querySelector('tbody').innerHTML = '';
      
      // Render header dengan tanggal
      currentWeek.forEach(day => {
        const th = document.createElement('th');
        th.innerHTML = `${day.day}<br>${day.date}`;
        tableElement.querySelector('thead tr').appendChild(th);
      });
      
      // Render baris untuk setiap karyawan
      for (let i = 0; i < rowCount; i++) {
        const employeeSchedule = sectionData[i];
        
        // Jika tidak ada data untuk baris ini, buat data default
        if (!employeeSchedule) {
          const defaultEmployee = employeesData[i] || { id: `temp-${i}`, name: 'Pilih Karyawan' };
          sectionData[i] = {
            employeeId: defaultEmployee.id,
            employeeName: defaultEmployee.name,
            shifts: Array(7).fill('L')
          };
          saveScheduleData(scheduleData);
        }
        
        const row = document.createElement('tr');
        
        // Kolom nama karyawan
        const nameCell = document.createElement('td');
        nameCell.className = 'employee-name';
        
        if (isEditMode) {
          // Dropdown untuk memilih karyawan
          const select = document.createElement('select');
          select.className = 'employee-select';
          select.setAttribute('data-section', section);
          select.setAttribute('data-index', i);
          
          // Opsi default
          const defaultOption = document.createElement('option');
          defaultOption.value = '';
          defaultOption.textContent = 'Pilih Karyawan';
          defaultOption.disabled = true;
          defaultOption.selected = !employeeSchedule.employeeId;
          select.appendChild(defaultOption);
          
          // Tambahkan opsi untuk semua karyawan
          employeesData.forEach(emp => {
            const option = document.createElement('option');
            option.value = emp.id;
            option.textContent = emp.name;
            if (emp.id === employeeSchedule.employeeId) {
              option.selected = true;
            }
            select.appendChild(option);
          });
          
          select.addEventListener('change', handleEmployeeChange);
          nameCell.appendChild(select);
        } else {
          // Tampilkan nama saja
          const employee = employeesData.find(emp => emp.id === employeeSchedule.employeeId);
          nameCell.textContent = employee ? employee.name : 'Belum dipilih';
        }
        
        row.appendChild(nameCell);
        
        // Kolom shift untuk setiap hari
        const shifts = employeeSchedule.shifts;
        shifts.forEach((shift, dayIndex) => {
          const shiftCell = document.createElement('td');
          shiftCell.className = 'shift-cell';
          
          if (isEditMode) {
            // Dropdown untuk memilih shift
            const select = document.createElement('select');
            select.className = 'shift-select';
            select.setAttribute('data-section', section);
            select.setAttribute('data-employee-id', employeeSchedule.employeeId);
            select.setAttribute('data-day-index', dayIndex);
            
            // Tambahkan opsi shift
            SHIFT_OPTIONS.forEach(option => {
              const optElement = document.createElement('option');
              optElement.value = option.code;
              optElement.textContent = option.code;
              optElement.title = option.name;
              if (option.code === shift) {
                optElement.selected = true;
              }
              select.appendChild(optElement);
            });
            
            select.addEventListener('change', handleShiftChange);
            shiftCell.appendChild(select);
          } else {
            // Tampilkan shift dengan warna
            if (employeeSchedule.employeeId && employeeSchedule.employeeId !== '') {
              const shiftDisplay = document.createElement('div');
              shiftDisplay.className = `shift-display shift-${shift}`;
              shiftDisplay.textContent = shift;
              shiftDisplay.title = SHIFT_OPTIONS.find(s => s.code === shift)?.name || shift;
              shiftCell.appendChild(shiftDisplay);
            } else {
              shiftCell.textContent = '-';
            }
          }
          
          row.appendChild(shiftCell);
        });
        
        tableElement.querySelector('tbody').appendChild(row);
      }
    }
    
    // Handle perubahan karyawan
    function handleEmployeeChange(event) {
      const select = event.target;
      const section = select.getAttribute('data-section');
      const index = parseInt(select.getAttribute('data-index'));
      const newEmployeeId = select.value;
      
      const scheduleData = getScheduleData();
      const employeeSchedule = scheduleData[section][index];
      
      if (employeeSchedule) {
        const newEmployee = employeesData.find(emp => emp.id === newEmployeeId);
        employeeSchedule.employeeId = newEmployeeId;
        employeeSchedule.employeeName = newEmployee ? newEmployee.name : 'Pilih Karyawan';
        
        saveScheduleData(scheduleData);
        renderScheduleTables(); // Render ulang untuk memperbarui tampilan
      }
    }
    
    // Handle perubahan shift
    function handleShiftChange(event) {
      const select = event.target;
      const section = select.getAttribute('data-section');
      const employeeId = select.getAttribute('data-employee-id');
      const dayIndex = parseInt(select.getAttribute('data-day-index'));
      const newShift = select.value;
      
      const scheduleData = getScheduleData();
      const employeeSchedule = scheduleData[section].find(s => s.employeeId === employeeId);
      
      if (employeeSchedule) {
        employeeSchedule.shifts[dayIndex] = newShift;
        saveScheduleData(scheduleData);
      }
    }
    
    // Format data untuk dikirim ke webhook
    function formatScheduleDataForWebhook() {
      const scheduleData = getScheduleData();
      const webhookData = {
        week: currentWeek.map(day => day.fullDate),
        weekDisplay: `${currentWeek[0].date} - ${currentWeek[6].date}`,
        lastUpdated: scheduleData.lastUpdated,
        schedules: []
      };
      
      // Gabungkan data barista dan kitchen
      ['barista', 'kitchen'].forEach(section => {
        scheduleData[section].forEach(employeeSchedule => {
          webhookData.schedules.push({
            section: section,
            employeeId: employeeSchedule.employeeId,
            employeeName: employeeSchedule.employeeName,
            shifts: employeeSchedule.shifts
          });
        });
      });
      
      return webhookData;
    }
    
    // Simpan jadwal ke server
    async function saveScheduleToServer() {
      showNotification("Mengirim data jadwal ke server...", "info");
      
      try {
        const scheduleData = formatScheduleDataForWebhook();
        
        const response = await fetch(WEBHOOK_POST_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(scheduleData)
        });
        
        if (response.ok) {
          showNotification("‚úÖ Data jadwal berhasil disimpan ke server!", "success");
        } else {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
      } catch (error) {
        console.error('Error saving schedule:', error);
        showNotification("‚ùå Gagal menyimpan data jadwal ke server", "error");
      }
    }
    
    // Muat jadwal dari server
    async function loadScheduleFromServer() {
      showNotification("Memuat data jadwal dari server...", "info");
      
      try {
        const response = await fetch(WEBHOOK_GET_URL);
        
        if (response.ok) {
          const serverData = await response.json();
          
          // Proses data dari server
          if (serverData && serverData.schedules) {
            processServerData(serverData);
            showNotification("‚úÖ Data jadwal berhasil dimuat dari server!", "success");
          } else {
            // Jika server tidak mengembalikan data, gunakan data default
            initializeScheduleData();
            showNotification("‚ÑπÔ∏è Tidak ada data di server, menggunakan data default", "info");
          }
        } else {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
      } catch (error) {
        console.error('Error loading schedule:', error);
        showNotification("‚ùå Gagal memuat data jadwal dari server", "error");
        
        // Fallback ke data lokal
        showNotification("‚ÑπÔ∏è Menggunakan data lokal sebagai fallback", "info");
      }
      
      renderScheduleTables();
    }
    
    // Proses data dari server
    function processServerData(serverData) {
      const scheduleData = {
        barista: [],
        kitchen: [],
        lastUpdated: serverData.lastUpdated || new Date().toISOString()
      };
      
      // Pisahkan data berdasarkan section
      serverData.schedules.forEach(schedule => {
        if (schedule.section === 'barista') {
          scheduleData.barista.push(schedule);
        } else if (schedule.section === 'kitchen') {
          scheduleData.kitchen.push(schedule);
        }
      });
      
      // Pastikan jumlah baris sesuai (4 untuk barista, 3 untuk kitchen)
      while (scheduleData.barista.length < 4) {
        scheduleData.barista.push({
          employeeId: '',
          employeeName: 'Pilih Karyawan',
          shifts: Array(7).fill('L')
        });
      }
      
      while (scheduleData.kitchen.length < 3) {
        scheduleData.kitchen.push({
          employeeId: '',
          employeeName: 'Pilih Karyawan',
          shifts: Array(7).fill('L')
        });
      }
      
      saveScheduleData(scheduleData);
    }
    
    // Tampilkan pesan
    function showMessage(message, type) {
      messageEl.textContent = message;
      messageEl.className = `message ${type}`;
      
      // Sembunyikan pesan setelah 5 detik untuk tipe success dan info
      if (type === 'success' || type === 'info') {
        setTimeout(() => {
          messageEl.style.display = 'none';
        }, 5000);
      }
    }
    
    // Tampilkan notifikasi popup
    function showNotification(message, type) {
      notificationEl.textContent = message;
      notificationEl.className = `notification ${type}`;
      notificationEl.style.display = 'block';
      
      // Sembunyikan notifikasi setelah 4 detik
      setTimeout(() => {
        notificationEl.style.display = 'none';
      }, 4000);
    }
    
    // Inisialisasi aplikasi ketika halaman dimuat
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
