<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Absensi Karyawan</title>
<style>
  body{font-family:Arial, sans-serif;margin:0;padding:18px;background:#f4f6fb}
  .card{max-width:480px;margin:18px auto;padding:18px;background:#fff;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.08)}
  h1{text-align:center;font-size:20px;margin:0 0 14px}
  label{display:block;margin-top:10px;font-weight:600}
  select,button{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid #ccc;font-size:15px}
  .primary{background:#0b74de;color:#fff;border:0}
  .muted{background:#eee}
  #notice{margin-top:12px;font-size:14px;text-align:center}
</style>
</head>
<body>
  <div class="card">
    <h1>Absensi Karyawan</h1>

    <label for="nama">Nama</label>
    <select id="nama">
      <option value="Crew1">Crew1</option>
      <option value="Crew2">Crew2</option>
      <option value="Crew3">Crew3</option>
    </select>

    <label for="shift">Shift</label>
    <select id="shift">
      <option value="Pagi">Pagi</option>
      <option value="Siang">Siang</option>
    </select>

    <button class="primary" onclick="submitAbsensi('Masuk Shift')">Masuk Shift</button>
    <button class="muted" onclick="submitAbsensi('Selesai Shift')">Selesai Shift</button>

    <div id="notice">üìç Menunggu izin lokasi...</div>
  </div>

<script>
const WEBHOOK_URL = "https://n8n-uievozfh3got.bgxy.sumopod.my.id/webhook-test/attendance-receiver";

function submitAbsensi(status){
  const notice = document.getElementById("notice");
  notice.textContent = "‚è≥ Mengambil lokasi...";

  if (!navigator.geolocation){
    notice.textContent = "‚ùå Browser tidak mendukung geolokasi.";
    return;
  }

  navigator.geolocation.getCurrentPosition(async pos => {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;
    const payload = {
      nama: document.getElementById("nama").value,
      shift: document.getElementById("shift").value,
      status: status,
      datetime: new Date().toISOString(),
      latitude: lat,
      longitude: lon
    };

    try {
      notice.textContent = "üì§ Mengirim data...";
      const res = await fetch(WEBHOOK_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      if(res.ok){
        notice.textContent = "‚úÖ Absensi berhasil terkirim.";
        // Tutup otomatis (misalnya di Telegram in-app browser)
        setTimeout(()=>{ window.close(); }, 2000);
      } else {
        notice.textContent = "‚ùå Gagal kirim (status " + res.status + ")";
      }
    } catch(e){
      console.error(e);
      notice.textContent = "‚ùå Error saat kirim data.";
    }
  }, err => {
    notice.textContent = "‚ùå Gagal ambil lokasi: " + err.message;
  }, { enableHighAccuracy:true, timeout:10000, maximumAge:0 });
}
</script>
</body>
</html>
